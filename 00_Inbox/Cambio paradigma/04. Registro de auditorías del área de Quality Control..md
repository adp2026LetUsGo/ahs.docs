> [!NOTE]
> Registro de auditorías del área de Quality Control. 

## Gemini dijo

En el contexto de tu desarrollo para el embarque de medicamentos, el **Registro de Auditoría (Audit Trail)** de _Quality Control_ (QC) no es solo un log de errores; es la "caja negra" legal y técnica que garantiza que los datos no han sido manipulados.

Para un programador en **.NET 10**, esto se traduce en una implementación estricta de la norma **FDA 21 CFR Part 11**, que rige la integridad de datos en la industria farmacéutica.

---

### 1. ¿Qué es técnicamente?

Es un registro cronológico, generado por el sistema, que proporciona evidencia documental de la secuencia de actividades que han afectado a una operación, procedimiento o evento específico.

Si tu software dice que el medicamento llegó a **5°C**, el registro de auditoría debe responder:

- **Quién** tomó la lectura (¿Fue un sensor automático o un humano?).
    
- **Qué** valor se registró originalmente.
    
- **Cuándo** sucedió (Timestamp inmutable).
    
- **Por qué** se cambió (si hubo una corrección manual, debe haber un motivo justificado).
    

### 2. Los 4 Pilares del Audit Trail (ALCOA+)

En Control de Calidad, seguimos el principio ALCOA+ para validar que el registro sea íntegro:

1. **Atribuible:** Se sabe quién hizo la acción.
    
2. **Legible:** Los datos deben ser permanentes y comprensibles.
    
3. **Contemporáneo:** Registrado en el momento exacto en que ocurre.
    
4. **Original:** El primer registro guardado.
    
5. **Exacto:** Sin errores de redondeo o transmisión.
    

---

### 3. Implementación en C# 14 / .NET 10

Para tu sistema de temperatura, el registro de auditoría no puede ser una simple tabla de SQL donde cualquiera pueda hacer un `DELETE`. Debe ser **Append-Only** (solo añadir).

#### Estrategias recomendadas:

- **Event Sourcing:** En lugar de guardar el estado actual de la temperatura, guardas la serie de eventos. El "Estado de Calidad" es el resultado de sumar todos esos eventos.
    
- **Hashing de Registros:** Cada entrada del log debe contener el _Hash_ de la entrada anterior (similar a una Blockchain). Si alguien intenta alterar un registro de temperatura de hace tres días, la cadena de hashes se rompe y la auditoría falla.
    
- **Immutable Types:** Usa `readonly struct` o `record` en C# 14 para asegurar que los objetos de auditoría no cambien en memoria mientras se procesan.
    


``` c#
// Ejemplo conceptual de un registro de auditoría inmutable en C# 14
public record AuditEntry(
    DateTimeOffset Timestamp,
    string UserId,
    string Action,
    decimal OldValue,
    decimal NewValue,
    string ReasonCode,
    string Hash // Hash(PreviousEntry + CurrentData)
);
```

---

### 4. ¿Por qué es vital para tus medicamentos?

Si un lote de insulina se arruina porque la temperatura subió a 15°C y alguien en el software intenta "borrar" ese pico para evitar una multa, el **Registro de Auditoría** detectará el hueco en la secuencia. Sin un Audit Trail sólido, el departamento de Quality Control no puede certificar el producto y el embarque es ilegal.

> **Dato curioso:** Al igual que el **Planímetro** que mencionaste, el Audit Trail es una "herramienta de validación". Mientras el planímetro valida áreas físicas, el Audit Trail valida la "verdad digital" de tus datos.

¿Te gustaría que diseñemos una **estructura de base de datos inmutable** en C# para que tus registros de temperatura sean a prueba de auditorías de la FDA?