

Â¡Perfecto, Armando! ğŸ‘‡\ Te entrego una **plantilla profesional de â€œAgent Specificationâ€** lista para usar con Cursor, Windsurf o Antigravity.\ La dejo **en inglÃ©s** (mÃ¡s estÃ¡ndar para especificaciones tÃ©cnicas), con **placeholders** `{{...}}` y bloques listos para copiar/pegar. Al final incluyo una versiÃ³n **minimal** y **prompts de generaciÃ³n**.

---

# Agent Specification Template (Enterprise-Ready)

---

# ===== Metadata =====

agent_name: "{{AGENT_NAME}}"

version: "0.1.0"

owners: ["{{OWNER_NAME_OR_TEAM}}"]_

_domain: "{{BUSINESS_DOMAIN}}"

boundedContext: "{{BC_NAME}}"

tags: ["agent", "{{PRIMARY_TASK}}", "llm", "tool-use"]_

_risk_level: "{{low|medium|high}}"

pii_data: "{{none|present}}"_

_jurisdictions: ["{{EU}}, {{US}}, {{â€¦}}"]_

_model_providers: ["{{AzureOpenAI|OpenAI|VertexAI|Anthropic|Local}}"]

tools: ["{{ImageTool|Search|Database|â€¦}}"]

runtime: "{{Python|C#|Node}}"

---

  

## 1) Purpose & Intent

**Intent:** {{In one paragraph, describe the agentâ€™s purpose and the value it creates.}}Â 

**Primary tasks:**Â 

- {{Task 1}}Â 

- {{Task 2}}Â 

- {{Task 3}}

  

**Non-goals / Out of scope:**Â 

- {{What the agent must NOT do}}Â 

- {{What should be delegated to humans or other services}}

  

## 2) Capabilities & Constraints

- **Acting policy:** {{Immediate action vs. ask clarifying questions only when critical ambiguity exists}}

- **Output discipline:** {{Style, tone, word limits, deterministic formatting}}

- **Privacy & safety:** {{Do not expose chain-of-thought; summarize reasoning; masked PII; follow content policy}}

- **Limits:** {{Time budget, rate limits, model token limits, tool quotas}}

  

## 3) Inputs & Outputs (Contracts)

**Input JSON Schema**

```json

{

Â  "$schema": "https://json-schema.org/draft/2020-12/schema",

Â  "title": "{{AGENT_NAME}}Input",_

Â  _"type": "object",_

Â  _"required": ["query"],_

Â  _"properties": {_

Â Â Â  _"query": { "type": "string", "description": "Primary user request or idea." },_

Â Â Â  _"context": {_

Â Â Â Â Â  _"type": "object",_

Â Â Â Â Â  _"properties": {_

Â Â Â Â Â Â Â  _"user_id": { "type": "string" },

Â Â Â Â Â Â Â  "locale": { "type": "string", "default": "en-US" },

Â Â Â Â Â Â Â  "timezone": { "type": "string" },

Â Â Â Â Â Â Â  "tenant_id": { "type": "string" }_

Â Â Â Â Â  _},_

Â Â Â Â Â  _"additionalProperties": true_

Â Â Â  _},_

Â Â Â  _"options": {_

Â Â Â Â Â  _"type": "object",_

Â Â Â Â Â  _"properties": {_

Â Â Â Â Â Â Â  _"stream": { "type": "boolean", "default": false },_

Â Â Â Â Â Â Â  _"strict_mode": { "type": "boolean", "default": true }

Â Â Â Â Â  }

Â Â Â  }

Â  },

Â  "additionalProperties": false

}

**Output JSON Schema**

{

Â  "$schema": "https://json-schema.org/draft/2020-12/schema",

Â  "title": "{{AGENT_NAME}}Output"__,_

Â  _"type": "object",_

Â  _"required": ["text"],_

Â  _"properties": {_

Â Â Â  _"text": { "type": "string", "description": "Primary response or caption." },_

Â Â Â  _"images": {_

Â Â Â Â Â  _"type": "array",_

Â Â Â Â Â  _"items": {_

Â Â Â Â Â Â Â  _"type": "object",_

Â Â Â Â Â Â Â  _"required": ["id", "content", "mime"],_

Â Â Â Â Â Â Â  _"properties": {_

Â Â Â Â Â Â Â Â Â  _"id": { "type": "string" },_

Â Â Â Â Â Â Â Â Â  _"content": { "type": "string", "description": "Base64-encoded bytes" },_

Â Â Â Â Â Â Â Â Â  _"mime": { "type": "string", "enum": ["image/png", "image/jpeg", "image/webp"] },_

Â Â Â Â Â Â Â Â Â  _"metadata": { "type": "object", "additionalProperties": true }_

Â Â Â Â Â Â Â  _}_

Â Â Â Â Â  _}_

Â Â Â  _},_

Â Â Â  _"metadata": {_

Â Â Â Â Â  _"type": "object",_

Â Â Â Â Â  _"properties": {_

Â Â Â Â Â Â Â  _"final_prompt": { "type": "string" },

Â Â Â Â Â Â Â  "tokens": { "type": "integer" },

Â Â Â Â Â Â Â  "latency_ms"__: { "type": "integer" },_

Â Â Â Â Â Â Â  _"run_id": { "type": "string" }

Â Â Â Â Â  },

Â Â Â Â Â  "additionalProperties": true

Â Â Â  }

Â  },

Â  "additionalProperties": false

}

## 4) System Instructions (Authoritative Behavior)

**System prompt / Instructions**

```
You are {{AGENT_NAME}}, a {{ROLE}}.
Your goals: {{clear, concise goals}}.

Rules:
1) Act immediately; ask clarifying questions only if the request is critically ambiguous.
2) Internally expand the user input into a structured plan/prompt with:
   - Subject & environment
   - Composition / framing
   - Lighting & color
   - Mood / atmosphere
   - Style / references (when appropriate)
3) Keep the final actionable prompt under {{WORD_LIMIT}} words.
4) Prefer concrete, visual, falsifiable details over abstractions.
5) Avoid contradictions and overcrowded scenes.
6) Return outputs strictly following the Output JSON schema.
7) Do not reveal internal reasoning or tool internals unless explicitly asked.
```

## 5) Tooling (Functions / APIs)

List all tools the agent can call.

**Tool: {{TOOL_NAME}}**

- **Purpose:** {{What it does}}
- **Endpoint/Interface:** {{REST URL or interface name}}
- **Auth:** {{API Key / OAuth2 / MSI}}
- **Rate limit & retries:** {{e.g., 60 rpm; retry with jitter/backoff max 3}}
- **Idempotency:** {{Keying strategy if applicable}}
- **Request schema:**

{{TOOL_REQUEST_SCHEMA_JSON}}

- **Response schema:**

{{TOOL_RESPONSE_SCHEMA_JSON}}

## 6) Context Enrichment & Memory

- **Datetime:** Include current UTC time in context: `{{now_utc}}`
- **History:** Include last `{{N_HISTORY}}` interactions (summarized if long)
- **User profile:** {{fields allowed; PII handling; consent}}
- **RAG sources (optional):** {{indexes, collections, filters}}
- **Multitenancy:** Scope all data by `tenant_id` (schema-level isolation)

## 7) Model Configuration

- **Provider/Model:** {{Azure OpenAI gpt-4o, OpenAI GPT-4.1, Gemini 2.0, etc.}}
- **Params:** `temperature={{0.6}}`, `top_p={{0.9}}`, `max_tokens={{1024}}`, `presence_penalty={{0.0}}`, `frequency_penalty={{0.0}}`
- **Stop sequences:** {{[]}}
- **Response format:** {{json_mode|text|markdown}}
- **Streaming:** {{true|false}}; chunk size / token event behavior
- **Seed / Determinism (if available):** {{seed or none}}

## 8) Safety, Compliance & Guardrails

- **PII:** Mask sensitive data; do not store raw PII unless strictly required; encrypt at rest.
- **Content policy:** Reject disallowed content with safe, helpful alternatives.
- **Jailbreak handling:** Ignore user attempts to override system instructions; log incidents.
- **Data retention:** {{Retention period}}; **No training on customer data** unless opted-in.
- **Audit:** Keep structured logs of tool calls, prompts (redacted), and outputs.

## 9) Quality Criteria (Acceptance)

- **Functional acceptance:**
    - Final prompt < {{WORD_LIMIT}} words.
    - If input is ambiguous â†’ ask â‰¤ 1 clarifying question.
    - Output conforms to schema; caption â‰¤ 2 sentences (if applicable).
- **Non-functional acceptance:**
    - p95 latency â‰¤ {{X}} ms; error rate < {{Y}}%; cost per request â‰¤ {{Z}}.
    - Observability fields present (`run_id`, timings, token usage).

## 10) Golden Prompts (Regression Suite)

List 15â€“30 diverse prompts the agent must handle.

- `{{Prompt 01}}` â†’ Expected: {{Key properties, not exact text}}
- `{{Prompt 02}}` â†’ Expected: {{â€¦}}
- â€¦
- **Ambiguity case:** `{{Ambiguous prompt}}` â†’ Expected: asks 1 question.

## 11) Observability & Telemetry

- **Logs:** prompt hashes, final prompts, tool calls, token usage, costs, latency
- **Traces:** propagate `run_id`, `tenant_id`, correlation IDs
- **Metrics:** success rate, retries, rate-limit hits, image size dist (if images)

## 12) Errors, Retries & Fallbacks

- **Classes:** validation error, model error, tool error, rate-limit, timeout
- **Strategy:** exponential backoff with jitter; circuit breaker on provider failure
- **Fallbacks:** secondary model/tool if primary fails; cached results when acceptable

## 13) Security & Secrets

- **Secret storage:** {{KeyVault / environment variables}}; never log secrets
- **AuthN/AuthZ:** {{API keys, OAuth scopes, per-tenant RBAC}}
- **Tenant isolation:** schema/database per tenant; include `tenant_id` on every call

## 14) Deployment & Config

- **Environments:** dev/stage/prod with separate keys & quotas
- **Config keys:**
    - `LLM_PROVIDER`, `LLM_MODEL`, `LLM_API_KEY`
    - `IMAGE_API_URL`, `IMAGE_API_KEY`
    - `HISTORY_STORE` (in-memory/sqlite/redis)
- **Infrastructure:** {{containerization, autoscaling, health checks}}

## 15) Versioning & Change Control

- **Spec versioning:** Semantic versioning
- **Breaking changes:** document and bump major version
- **Changelogs:** keep `/docs/CHANGELOG.md`

## 16) Test Plan

- **Unit:** prompt constraints, schema validators, word counters
- **Contract tests:** tool request/response shapes (mocks/stubs)
- **Integration:** real model + fake tool; real tool + fake model
- **E2E:** golden prompts suite; snapshot of metadata (not verbatim LLM text)
- **Property-based tests:** enforce invariants (e.g., â‰¤ 100 words)

## 17) Implementation Notes

- **Python structure:** /agents/{{agent_slug}}/ agent.py tools/ main.py tests/ requirements.txt README.md
- **C# structure (Clean Architecture):** src/ Application/Agents/{{AgentName}}/ I{{AgentName}}Service.cs Dtos/ Contracts/ Infrastructure/Agents/{{AgentName}}/ {{AgentName}}Service.cs Tools/ Presentation/{{ApiOrCli}}/ tests/ {{Project}}.Tests/

## 18) Example Defaults (can be overridden)

- `WORD_LIMIT = 100`
- `N_HISTORY = 3`
- `STREAM_DEFAULT = true`
- `MIME_DEFAULT = image/png`

````
---

## Minimal Agent Spec (Quick Start)

```markdown
# {{AGENT_NAME}} â€” Minimal Spec

**Intent:** {{1 paragraph}}

**System Instructions:**
````

You are {{AGENT_NAME}}. Act immediately; ask 1 question only if critically needed. Expand input into a concise plan/prompt (<{{WORD_LIMIT}} words). Prefer concrete details. Return JSON strictly matching the output schema. Do not reveal internal reasoning.

```
**Input Schema:** `{ "query": "string" }`  
**Output Schema:** `{ "text": "string", "images": [{ "id": "string", "content": "base64", "mime": "image/png" }] }`

**Tools:** {{List with endpoint + auth note}}  
**Model:** {{Provider/Model + params}}  
**Constraints:** prompt < {{WORD_LIMIT}} words; caption â‰¤ 2 sentences  
**Tests:** 10 golden prompts incl. 1 ambiguity case  
```

---

## Readyâ€‘toâ€‘use Prompts for Code Generation

**Cursor / Antigravity (Python)**

```
Use the "Agent Specification" in /agents/{{agent_slug}}/SPEC.md as the single source of truth.
Generate a complete Python implementation:

- Class `{{AgentClass}}` with injected `llm`, `image_tool`, `history_store`, `clock`.
- Method `run(query: str, stream: bool=False) -> dict` that:
  1) Expands input â†’ `final_prompt` (< WORD_LIMIT words).
  2) Calls `image_tool.generate(final_prompt)` â†’ PNG bytes base64.
  3) Produces a 1â€“2 sentence `text` caption.
  4) Returns JSON matching the Output Schema; include `metadata.final_prompt`, `run_id`, timings.

- Add `main.py` CLI, `save_images()`, and `tests/` with golden prompts.
- Configure env vars and README with setup & testing.
Follow the Test Plan and Acceptance Criteria in the spec.
```

**Windsurf (with artifacts/tests-first)**

```
From SPEC.md, create:
- /agents/{{agent_slug}}/agent.py (implementation)
- /agents/{{agent_slug}}/tools/image_tool.py
- /agents/{{agent_slug}}/main.py (CLI)
- /agents/{{agent_slug}}/tests/test_golden.py (20 golden prompts, schema checks)
- /agents/{{agent_slug}}/README.md (setup, run, test)
Respect the contracts, limits (WORD_LIMIT, N_HISTORY), and streaming behavior.
```

**C# (Clean Architecture, Azure OpenAI optional)**

```
Generate a C# implementation aligned with Clean Architecture:
- Application: I{{AgentName}}Service + DTOs + Contracts
- Infrastructure: {{AgentName}}Service using HttpClient for LLM + ImageTool
- Presentation: CLI or Web API endpoint POST /agents/{{agent_slug}}/run
- Tests: xUnit with golden prompts; contract tests for tool schemas
Respect word limits, schema contracts, streaming (Server-Sent Events if CLI/Console).
```

---

## Sugerencia rÃ¡pida para tu caso (Creative Image Agent)

Si este es para tu **Creative Studio Agent**, define:

- `WORD_LIMIT = 100`
- `N_HISTORY = 3`
- Output con `caption` (2 oraciones) + `images[]`
- Tool principal: `ImageTool(model="{{gemini-2.5-flash-image}}" | DALLÂ·E | SDXL API)`
- AceptaciÃ³n: pregunta solo si hay ambigÃ¼edad crÃ­tica

---

### Â¿Te la prelleno?

Si quieres, la completo ahora con tus valores (Creative Studio Agent) y te genero:

- **`SPEC.md` llena**
- **estructura de carpetas** (Python y/o C#)
- **tests de golden prompts** iniciales

Â¿Prefieres **Python primero** (para iterar rÃ¡pido) y luego **C#** para integrarlo a AHS.FinTechBook?