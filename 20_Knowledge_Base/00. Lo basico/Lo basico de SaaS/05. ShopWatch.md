¬°Listo, Armando! He **creado y empaquetado** un **scaffold completo** para tu Micro‚ÄëSaaS **ShopWatch** (limpio, en ingl√©s, .NET 8, Clean Architecture, multitenancy por `TenantId`, JWT + API Key stubs, SQL Server por defecto y PostgreSQL posible). Incluye **c√≥digo**, **proyectos .csproj**, **scripts**, **diagramas**, **landing copy**, y **tests con NSubstitute**.

---

## ‚¨áÔ∏è Descarga el paquete

**ShopWatch.zip** ‚Äî contiene todo el esqueleto listo para importar en tu monorepo:  
[ShopWatch.zip](blob:https://www.microsoft365.com/df281791-8b68-4e2a-bd6e-d734b96d686d)

---

## üìÅ Estructura principal

```
ShopWatch/
  Directory.Build.props
  .editorconfig
  README.md
  .gitignore
  build/
    create-solution.ps1
  docs/
    landing.md
    architecture/
      c4/
        ShopWatch-Context.puml
        ShopWatch-Container.puml
      mermaid/
        shopwatch-pipeline.md
    seeds/
      seed.sql
  src/
    ShopWatch.Domain/
      ShopWatch.Domain.csproj
      Entities/
        Tenant.cs
        User.cs
        Monitor.cs
        Check.cs
        Incident.cs
    ShopWatch.Application/
      ShopWatch.Application.csproj
      Abstractions/Repositories.cs
      Services/CheckEvaluator.cs
    ShopWatch.Infrastructure/
      ShopWatch.Infrastructure.csproj
      ShopWatchDbContext.cs
      Repositories/EfRepositories.cs
      Services/StubServices.cs
    ShopWatch.Web/
      ShopWatch.Web.csproj
      appsettings.Development.json
      Program.cs   <-- Minimal APIs + JWT + /auth/dev-token + monitors + status + billing stub
    ShopWatch.Worker/
      ShopWatch.Worker.csproj
      Program.cs   <-- BackgroundService: scheduler + HTTP checks + evaluator
  tests/
    ShopWatch.Tests/
      ShopWatch.Tests.csproj
      CheckEvaluatorTests.cs
```

---

## üöÄ C√≥mo ponerlo a correr (local)

> Requisitos: .NET 8 SDK, SQL Server (local o Azure SQL), PowerShell, y `dotnet-ef` (herramienta global).

1. **Coloca la carpeta en tu monorepo**  
    Ejemplo (seg√∫n tu convenci√≥n):  
    `C:\Users\armando\Documents\_AHS\AHS.MicroSaaS\apps\shopwatch\`
    
2. **Crea la soluci√≥n y agrega los proyectos**  
    Desde el directorio `ShopWatch/`:
    

./build/create-solution.ps1

3. **Configura conexi√≥n a base de datos**  
    Edita `src/ShopWatch.Web/appsettings.Development.json` ‚Üí `ConnectionStrings:Default` (SQL Server).

> El scaffold viene con una conexi√≥n local por defecto.

4. **Crear migraci√≥n inicial y aplicar DB**

# Instala dotnet-ef si no lo tienes

dotnet tool install --global dotnet-ef

  

cd src/ShopWatch.Web

dotnet ef migrations add InitialCreate -p ../ShopWatch.Infrastructure -s ./ -c ShopWatch.Infrastructure.ShopWatchDbContext

dotnet ef database update -s ./ -p ../ShopWatch.Infrastructure -c ShopWatch.Infrastructure.ShopWatchDbContext

5. **Seed m√≠nimo (opcional)**  
    En `docs/seeds/seed.sql` tienes un INSERT de ejemplo para crear un Tenant de pruebas (GUID ejemplo).
    
6. **Arrancar servicios**
    

- **API** (Swagger + Minimal APIs): `dotnet run --project src/ShopWatch.Web`
- **Worker** (scheduler): `dotnet run --project src/ShopWatch.Worker`

7. **Obtener un JWT (DEV ONLY) y probar endpoints**  
    Genera un token temporal:

POST [http://localhost:5000/auth/dev-token?tenantId=11111111-1111-1111-1111-111111111111&amp;email=me@example.com](http://localhost:5000/auth/dev-token?tenantId=11111111-1111-1111-1111-111111111111&amp;email=me@example.com)

Usa el `token` resultante como `Authorization: Bearer <token>` en:

- `GET /monitors`
- `POST /monitors` (crea un monitor con `Url`, `Method`=GET/HEAD, `ExpectKeyword` opcional, `IntervalSec`, `TimeoutMs`)

Status page p√∫blica (stub, sin auth):

- `GET /status/{slug}`

> **Nota**: Stripe webhook, email y Telegram est√°n **stub**; listos para cablear en la fase de integraci√≥n.

---

## üß™ Tests incluidos

- **xUnit + NSubstitute + FluentAssertions**  
    Ejemplo: `CheckEvaluatorTests` prueba que se abre un incidente tras **2 fallos consecutivos** (TDD-ready).

---

## üß© Arquitectura y convenciones incluidas

- **Clean Architecture** (Domain, Application, Infrastructure, Web, Worker).
- **Multitenancy** por `TenantId` (row-based).
- **JWT** (endpoint `/auth/dev-token` para desarrollo).
- **API Key** ‚Äî interfaz prevista; a√±ade un handler/middleware cuando abramos integraciones.
- **EF Core** con √≠ndices en entidades clave (`Monitor`, `Check`, `Incident`).
- **Worker** con `BackgroundService` que lanza checks HTTP, guarda resultados y eval√∫a incidentes con `CheckEvaluator`.
- **Docs**: C4 (PUML) y Mermaid (corporate/azul) listos para tu documentaci√≥n.

---

## ‚úÖ Siguientes pasos que puedo automatizar por ti

1. **Stripe (Billing)**
    
    - A√±adir `Stripe.Net`, endpoints de checkout, planes (`Starter/Pro/Business`) y **webhooks** reales.
    - Bloqueo de features al expirar trial / no pago.
2. **Alertas**
    
    - Integraci√≥n con **SendGrid** (email) y **Telegram Bot API**.
    - Pol√≠tica de alertas: ‚ÄúN fallos consecutivos‚Äù + backoff + _confirmation check_ para reducir falsos positivos.
3. **Status Page**
    
    - Generar slug por Tenant, logotipo (Pro+), uptime 24h/7d, timeline de incidentes.
4. **Hardening**
    
    - Rate limiting, CORS, request logging enriquecido en App Insights, retry con **Polly** en Worker.
    - Global query filters por `TenantId` (si quieres reforzar aislamiento).
5. **CI/CD (Azure)**
    
    - Pipelines para **App Service** (Web + Worker), variables de entorno seguras, _slots_ de staging.
6. **Fase 2 (IA ligera)**
    
    - Detecci√≥n de anomal√≠as de latencia (estad√≠stica simple).
    - Heur√≠sticas de predicci√≥n de incidentes (sin complicar el MVP).
    - Sugerencias de _root cause_ (c√≥digos, DNS, TTL).

---

## üí° Integraci√≥n con tu ecosistema AHS

- **Monorepo**: Recomiendo `AHS.MicroSaaS/apps/shopwatch/` y `AHS.MicroSaaS/docs/shopwatch/` para artefactos de producto.
- **Est√°ndares AHS**: Puedo convertir este scaffold a tu convenci√≥n de nombres, a√±adir `MkDocs` y enlazarlo a tu **Windsurf** (reglas/PRD).

---

¬øQuieres que **conecte ahora Stripe + SendGrid + Telegram** y deje los **webhooks y alertas** funcionando en el MVP (con pruebas)?  
Si lo prefieres, tambi√©n puedo **generar el pipeline de Azure** con variables de entorno y gu√≠as de despliegue.